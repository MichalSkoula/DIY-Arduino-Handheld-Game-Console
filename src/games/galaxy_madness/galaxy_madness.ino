#include <gamelib.h>

// bitmaps
static unsigned char playerBits[] = { 0x18, 0x3c, 0x7e, 0x7e, 0x3c, 0x3c, 0x7e, 0xff };
static unsigned char trashSmallBits[2][8] = { 
  { 0x30, 0x3c, 0xfe, 0xfe, 0x7f, 0x3f, 0x7e, 0x30 },
  { 0x10, 0x3c, 0x7e, 0x7e, 0x7f, 0x3f, 0x7c, 0x36 }
};

static unsigned char trashBigBits[2][32] = {
  {
    0x30, 0x3e, 0xfc, 0x7f, 0xfe, 0x7f, 0xfe, 0x7f, 0xff, 0x3f, 0xff, 0x3f,
    0xfe, 0x3f, 0xf8, 0x1f, 0xfc, 0x3f, 0xfc, 0x3f, 0xfc, 0x1f, 0xfe, 0x3f,
    0xfe, 0x3f, 0xf8, 0x1f, 0xe0, 0x10, 0x00, 0x00
  },
  {
    0x00, 0x38, 0x70, 0x7e, 0xf8, 0x7f, 0xfe, 0x7f, 0xff, 0x3f, 0xfe, 0x3f,
    0xfe, 0x3f, 0xf8, 0x1f, 0xfc, 0x3f, 0xf0, 0x3f, 0xf0, 0x1f, 0xf8, 0x3f,
    0xfe, 0x7f, 0xf8, 0x7e, 0xe0, 0x10, 0x00, 0x00
  } 
};

// constants
const byte step = 4;
const byte bitmapSize = 8;
const byte oneDamage = 25;
const byte gameWidth = 96;
const byte gameHeight = 64;

// variables
byte playerScore = 0;
byte playerHealth = 100;
byte playerX = 48;
byte playerY = 56;

byte bulletX;
int bulletY;

// x, y, size, type, velocity
int trashes[][5] = {
  { 10, 0, 2, 1, 1 },
  { 50, 0, 1, 1, 2 }
};
const byte trashesCount = sizeof(trashes) / sizeof(trashes[0]);

/*
 0 - menu,
 1 - single player
 2 - lose
 */ 
byte stage = 0;

void setup()
{
  initGame(INIT_ALL);
  display.setBitmapMode(1);  // bitmap transparent background
}

void loop() 
{
  // main menu
  if (stage == 0) {
    if (buttonPressed(START_BUTTON)) {
      stage = 1;
    }
  }
  
  if (stage == 1) {
    gameLoop();
  }  

  //draw everything
  pictureLoop();
}
